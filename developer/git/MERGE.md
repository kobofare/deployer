# Git 合并最近几次提交（Squash 提交）

本文档说明如何在 Git 中把「最近的几次提交」合并成 1 次提交，整理提交历史。

## 1. 适用场景与注意事项

- 适用：
  - 开发过程中产生了多次小提交，想在推到远程仓库前合并成一次（或少数几次）提交。
  - 清理本地分支的提交历史，让 `git log` 更简洁。

##  方法一

使用 `git rebase -i` 交互式合并（推荐）

### 查看最近提交

```bash
git log --oneline -n 10
```

### 启动交互式 rebase

以当前 HEAD 往前数 3 个提交，启动交互式 rebase。

```bash
git rebase -i HEAD~3
```

### 在编辑器中选择要合并的提交

命令执行后会打开编辑器，类似：
```text
pick 1122334 第 3 次提交
pick e4f5g6h 第 4 次提交
pick a1b2c3d 第 5 次提交
```
操作方式：

- 保留第一个提交为 `pick`（用作合并后的基准）。
- 后面的要合并进来的提交，把 `pick` 改为：
  - `s` 或 `squash`：合并提交并保留提交说明（可编辑）。
  - `f` 或 `fixup`：合并提交但忽略该提交的说明。

示例：将后两个合并到第一个：

```text
pick 1122334 第 3 次提交
s e4f5g6h 第 4 次提交
s a1b2c3d 第 5 次提交
```

保存并关闭编辑器。

### 编辑合并后的提交说明

若使用 `squash`，Git 会再次打开编辑器让你编辑合并后的提交信息。  
将多条提交信息整理为一条清晰的说明，例如：

```text
整理 XXX 功能的实现与测试

- 实现接口 ...
- 修复 bug ...
- 补充单元测试 ...
```

保存并退出。

### 处理冲突（如有）

如果 rebase 过程中出现冲突：

1. 按提示修改冲突文件。
2. 标记解决完成：

   ```bash
   git add <有冲突的文件>
   ```

3. 继续 rebase：

   ```bash
   git rebase --continue
   ```

重复上述步骤直到 rebase 完成。

### 推送到远程（重写历史时）

如果这些提交已经推送过远程，需要强制推送：

```bash
git push --force-with-lease
```

`--force-with-lease` 比 `--force` 更安全，会检查远程是否有你本地未知的新提交。

---

## 方法二

reset --soft + 重新提交（本地开发常用）

## 把 HEAD 回退到更早的提交

例如要把最近 3 次提交合并成 1 次：
```bash
git reset --soft HEAD~3
```

含义：

- 回到 3 次提交之前的状态。
- 保留这 3 次提交的所有修改到「暂存区」（index）中。

## 重新提交一次

```bash
git commit -m "合并后的提交说明：XXX 功能实现与修复"
```

现在就用一个新的提交，包含了原来那 3 次提交的全部改动。

